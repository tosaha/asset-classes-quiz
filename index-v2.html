<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Asset Class Selection | Professional Trading Market Finder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --text: #1f2937;
            --text-light: #6b7280;
            --bg: #f9fafb;
            --white: #ffffff;
            --border: #e5e7eb;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 50px -10px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Display', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text);
        }

        .main-wrapper {
            display: flex;
            gap: 20px;
            max-width: 1600px;
            width: 100%;
            align-items: flex-start;
        }

        .container {
            flex: 1;
            max-width: 900px;
            width: 100%;
            background: var(--white);
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .content {
            padding: 40px 30px;
        }

        /* Profile Selection */
        .profile-section {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg);
            border-radius: 12px;
        }

        .profile-section h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text);
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .profile-btn {
            padding: 12px 16px;
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
        }

        .profile-btn:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .profile-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Constraints Section */
        .constraints-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .constraint-group {
            padding: 15px;
            background: var(--bg);
            border-radius: 8px;
        }

        .constraint-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .constraint-group select,
        .constraint-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--white);
            transition: all 0.2s ease;
        }

        .constraint-group select:focus,
        .constraint-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Slider Section */
        .slider-section {
            margin-bottom: 30px;
        }

        .slider-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text);
        }

        .slider-group {
            margin-bottom: 25px;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .slider-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        .slider-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
            background: var(--bg);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 3px solid var(--white);
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 3px solid var(--white);
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .slider-description {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
        }

        /* Results Panel */
        .results-panel {
            width: 400px;
            background: var(--white);
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            padding: 25px;
            position: sticky;
            top: 20px;
            animation: fadeIn 0.5s ease;
        }

        .results-panel h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--text);
            font-weight: 600;
        }

        .result-item {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg);
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .result-item.top {
            background: linear-gradient(135deg, #eef2ff 0%, #ffffff 100%);
            border-color: var(--primary);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .result-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .result-score {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .result-class {
            font-size: 12px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        /* Factor Attribution */
        .factor-list {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .factor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .factor-name {
            color: var(--text-light);
        }

        .factor-bar {
            flex: 1;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin: 0 10px;
            overflow: hidden;
        }

        .factor-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        /* Sensitivity Analysis */
        .sensitivity-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--bg);
            border-radius: 12px;
        }

        .sensitivity-section h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sensitivity-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .sensitivity-change {
            background: var(--white);
            padding: 4px 8px;
            border-radius: 4px;
            margin-right: 10px;
            font-weight: 500;
            color: var(--primary);
        }

        .sensitivity-result {
            color: var(--text-light);
        }

        /* Action Buttons */
        .action-section {
            margin-top: 30px;
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--bg);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .main-wrapper {
                flex-direction: column;
            }

            .results-panel {
                width: 100%;
                position: static;
                margin-top: 20px;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .content {
                padding: 30px 20px;
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }

            .constraints-section {
                grid-template-columns: 1fr;
            }

            .results-panel {
                padding: 20px;
            }
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--text);
            color: white;
            text-align: left;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <div class="container">
            <div class="header">
                <h1>Advanced Asset Class Selection</h1>
                <p>Professional-grade market matching with multi-criteria analysis</p>
            </div>

            <div class="content">
                <!-- Profile Selection -->
                <div class="profile-section">
                    <h3>Quick Profiles (Optional)</h3>
                    <div class="profile-grid">
                        <button class="profile-btn" onclick="loadProfile('systematic_swing')">Systematic Swing</button>
                        <button class="profile-btn" onclick="loadProfile('options_income')">Options Income</button>
                        <button class="profile-btn" onclick="loadProfile('prop_scalper')">Prop Scalper</button>
                        <button class="profile-btn" onclick="loadProfile('crypto_momentum')">Crypto Momentum</button>
                        <button class="profile-btn" onclick="loadProfile('conservative')">Conservative</button>
                        <button class="profile-btn" onclick="loadProfile('custom')">Custom</button>
                    </div>
                </div>

                <!-- Constraints -->
                <div class="constraints-section">
                    <div class="constraint-group">
                        <label>Region</label>
                        <select id="region" onchange="updateConstraints()">
                            <option value="US">United States</option>
                            <option value="EU">European Union</option>
                            <option value="UK">United Kingdom</option>
                            <option value="APAC">Asia-Pacific</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>
                    <div class="constraint-group">
                        <label>Account Type</label>
                        <select id="accountType" onchange="updateConstraints()">
                            <option value="cash">Cash Account</option>
                            <option value="margin">Margin Account</option>
                            <option value="prop">Prop Firm</option>
                            <option value="institutional">Institutional</option>
                        </select>
                    </div>
                    <div class="constraint-group">
                        <label>Starting Capital</label>
                        <input type="number" id="capital" value="10000" min="100" max="1000000" onchange="updateResults()">
                    </div>
                    <div class="constraint-group">
                        <label>Experience Level</label>
                        <select id="experience" onchange="updateResults()">
                            <option value="beginner">Beginner (< 1 year)</option>
                            <option value="intermediate">Intermediate (1-3 years)</option>
                            <option value="advanced">Advanced (3-5 years)</option>
                            <option value="expert">Expert (5+ years)</option>
                        </select>
                    </div>
                </div>

                <!-- Preference Sliders -->
                <div class="slider-section">
                    <h3>Trading Preferences</h3>
                    
                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">Risk Tolerance</span>
                            <span class="slider-value" id="risk-value">5</span>
                        </div>
                        <input type="range" class="slider" id="risk" min="0" max="10" value="5" oninput="updateSlider('risk')">
                        <div class="slider-description">Low risk = stable assets, High risk = volatile opportunities</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">Liquidity Needs</span>
                            <span class="slider-value" id="liquidity-value">7</span>
                        </div>
                        <input type="range" class="slider" id="liquidity" min="0" max="10" value="7" oninput="updateSlider('liquidity')">
                        <div class="slider-description">How important is tight spread and instant execution?</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">Cost Sensitivity</span>
                            <span class="slider-value" id="cost-value">5</span>
                        </div>
                        <input type="range" class="slider" id="cost" min="0" max="10" value="5" oninput="updateSlider('cost')">
                        <div class="slider-description">Higher = prefer lower fees and tighter spreads</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">Leverage Comfort</span>
                            <span class="slider-value" id="leverage-value">3</span>
                        </div>
                        <input type="range" class="slider" id="leverage" min="0" max="10" value="3" oninput="updateSlider('leverage')">
                        <div class="slider-description">Comfort with using margin and leveraged products</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">News/Fundamental Focus</span>
                            <span class="slider-value" id="news-value">5</span>
                        </div>
                        <input type="range" class="slider" id="news" min="0" max="10" value="5" oninput="updateSlider('news')">
                        <div class="slider-description">Preference for news-driven vs pure technical trading</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">Quantitative/Systematic</span>
                            <span class="slider-value" id="quant-value">5</span>
                        </div>
                        <input type="range" class="slider" id="quant" min="0" max="10" value="5" oninput="updateSlider('quant')">
                        <div class="slider-description">Preference for rules-based vs discretionary trading</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">24/7 Availability</span>
                            <span class="slider-value" id="hours24-value">3</span>
                        </div>
                        <input type="range" class="slider" id="hours24" min="0" max="10" value="3" oninput="updateSlider('hours24')">
                        <div class="slider-description">Need for round-the-clock market access</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">Regulatory Protection</span>
                            <span class="slider-value" id="regulation-value">7</span>
                        </div>
                        <input type="range" class="slider" id="regulation" min="0" max="10" value="7" oninput="updateSlider('regulation')">
                        <div class="slider-description">Importance of regulated markets and investor protection</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <span class="slider-label">Holding Period</span>
                            <span class="slider-value" id="timeframe-value">5</span>
                        </div>
                        <input type="range" class="slider" id="timeframe" min="0" max="10" value="5" oninput="updateSlider('timeframe')">
                        <div class="slider-description">0 = Scalping (seconds), 10 = Position (months)</div>
                    </div>
                </div>

                <div class="action-section">
                    <button class="btn btn-primary" onclick="calculateAndDisplay()">Calculate Best Markets</button>
                    <button class="btn btn-secondary" onclick="resetAll()">Reset</button>
                </div>
            </div>
        </div>

        <!-- Results Panel -->
        <div class="results-panel" id="resultsPanel" style="display: none;">
            <h3>Your Top Markets</h3>
            <div id="resultsContent">
                <!-- Results will be dynamically inserted here -->
            </div>

            <div class="sensitivity-section">
                <h4>Sensitivity Analysis</h4>
                <div id="sensitivityContent">
                    <!-- Sensitivity analysis will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Comprehensive Asset Universe with normalized properties
        const assetUniverse = {
            stocks_index: { 
                name: "Index ETFs (SPY, QQQ)", 
                class: "equities", 
                vol: 0.4, 
                liq: 0.95, 
                hours: "RTH", 
                lever: 2, 
                min_cap: 500, 
                reg: 0.95, 
                spread: 0.01, 
                fee: 0.01, 
                borrow: 0.9, 
                news: 0.6, 
                quant: 0.7, 
                discretion: 0.6, 
                hold_min: "minutes", 
                hold_max: "years",
                complexity: 0.3
            },
            stocks_single: { 
                name: "Single Stocks (AAPL, TSLA)", 
                class: "equities", 
                vol: 0.7, 
                liq: 0.8, 
                hours: "RTH", 
                lever: 2, 
                min_cap: 1000, 
                reg: 0.95, 
                spread: 0.05, 
                fee: 0.02, 
                borrow: 0.6, 
                news: 0.9, 
                quant: 0.6, 
                discretion: 0.8, 
                hold_min: "minutes", 
                hold_max: "months",
                complexity: 0.4
            },
            stocks_smallcap: {
                name: "Small Cap Stocks",
                class: "equities",
                vol: 0.85,
                liq: 0.5,
                hours: "RTH",
                lever: 2,
                min_cap: 2500,
                reg: 0.95,
                spread: 0.15,
                fee: 0.02,
                borrow: 0.3,
                news: 0.7,
                quant: 0.4,
                discretion: 0.9,
                hold_min: "days",
                hold_max: "months",
                complexity: 0.6
            },
            crypto_majors: { 
                name: "Crypto Majors (BTC, ETH)", 
                class: "crypto", 
                vol: 0.9, 
                liq: 0.9, 
                hours: "24/7", 
                lever: 5, 
                min_cap: 100, 
                reg: 0.4, 
                spread: 0.02, 
                fee: 0.05, 
                borrow: 0.0, 
                news: 0.8, 
                quant: 0.7, 
                discretion: 0.7, 
                hold_min: "seconds", 
                hold_max: "years",
                complexity: 0.5
            },
            crypto_alts: { 
                name: "Crypto Altcoins", 
                class: "crypto", 
                vol: 1.0, 
                liq: 0.5, 
                hours: "24/7", 
                lever: 5, 
                min_cap: 100, 
                reg: 0.3, 
                spread: 0.08, 
                fee: 0.08, 
                borrow: 0.0, 
                news: 0.9, 
                quant: 0.6, 
                discretion: 0.8, 
                hold_min: "seconds", 
                hold_max: "weeks",
                complexity: 0.7
            },
            crypto_defi: {
                name: "DeFi Tokens",
                class: "crypto",
                vol: 1.0,
                liq: 0.4,
                hours: "24/7",
                lever: 3,
                min_cap: 500,
                reg: 0.2,
                spread: 0.12,
                fee: 0.10,
                borrow: 0.0,
                news: 0.8,
                quant: 0.5,
                discretion: 0.9,
                hold_min: "hours",
                hold_max: "weeks",
                complexity: 0.9
            },
            fx_majors: { 
                name: "FX Major Pairs (EUR/USD)", 
                class: "forex", 
                vol: 0.35, 
                liq: 1.0, 
                hours: "24/5", 
                lever: 10, 
                min_cap: 200, 
                reg: 0.8, 
                spread: 0.01, 
                fee: 0.01, 
                borrow: 0.0, 
                news: 0.7, 
                quant: 0.8, 
                discretion: 0.6, 
                hold_min: "seconds", 
                hold_max: "months",
                complexity: 0.4
            },
            fx_minors: {
                name: "FX Minor Pairs",
                class: "forex",
                vol: 0.45,
                liq: 0.8,
                hours: "24/5",
                lever: 10,
                min_cap: 500,
                reg: 0.8,
                spread: 0.03,
                fee: 0.02,
                borrow: 0.0,
                news: 0.6,
                quant: 0.7,
                discretion: 0.7,
                hold_min: "minutes",
                hold_max: "weeks",
                complexity: 0.5
            },
            fx_exotic: {
                name: "FX Exotic Pairs",
                class: "forex",
                vol: 0.7,
                liq: 0.5,
                hours: "24/5",
                lever: 10,
                min_cap: 1000,
                reg: 0.7,
                spread: 0.08,
                fee: 0.03,
                borrow: 0.0,
                news: 0.8,
                quant: 0.6,
                discretion: 0.8,
                hold_min: "hours",
                hold_max: "weeks",
                complexity: 0.7
            },
            fut_micro_index: { 
                name: "Micro Index Futures (MES, MNQ)", 
                class: "futures", 
                vol: 0.7, 
                liq: 0.9, 
                hours: "23/5", 
                lever: 10, 
                min_cap: 1500, 
                reg: 0.9, 
                spread: 0.02, 
                fee: 0.02, 
                borrow: 1.0, 
                news: 0.7, 
                quant: 0.8, 
                discretion: 0.7, 
                hold_min: "minutes", 
                hold_max: "weeks",
                complexity: 0.5
            },
            fut_emini: {
                name: "E-mini Futures (ES, NQ)",
                class: "futures",
                vol: 0.7,
                liq: 0.95,
                hours: "23/5",
                lever: 12,
                min_cap: 10000,
                reg: 0.9,
                spread: 0.01,
                fee: 0.03,
                borrow: 1.0,
                news: 0.7,
                quant: 0.8,
                discretion: 0.7,
                hold_min: "minutes",
                hold_max: "days",
                complexity: 0.6
            },
            fut_commodities: { 
                name: "Commodity Futures (CL, GC)", 
                class: "futures", 
                vol: 0.75, 
                liq: 0.7, 
                hours: "23/5", 
                lever: 12, 
                min_cap: 3000, 
                reg: 0.9, 
                spread: 0.04, 
                fee: 0.03, 
                borrow: 1.0, 
                news: 0.8, 
                quant: 0.7, 
                discretion: 0.7, 
                hold_min: "minutes", 
                hold_max: "months",
                complexity: 0.7
            },
            fut_bonds: {
                name: "Bond Futures (ZB, ZN)",
                class: "futures",
                vol: 0.3,
                liq: 0.8,
                hours: "23/5",
                lever: 15,
                min_cap: 2000,
                reg: 0.9,
                spread: 0.02,
                fee: 0.02,
                borrow: 1.0,
                news: 0.8,
                quant: 0.7,
                discretion: 0.6,
                hold_min: "hours",
                hold_max: "months",
                complexity: 0.6
            },
            options_liquid: { 
                name: "Options (SPY, QQQ, AAPL)", 
                class: "options", 
                vol: 0.6, 
                liq: 0.8, 
                hours: "RTH", 
                lever: 0, 
                min_cap: 2000, 
                reg: 0.95, 
                spread: 0.06, 
                fee: 0.03, 
                borrow: 1.0, 
                news: 0.7, 
                quant: 0.9, 
                discretion: 0.8, 
                hold_min: "days", 
                hold_max: "months",
                complexity: 0.8
            },
            options_index: {
                name: "Index Options (SPX, NDX)",
                class: "options",
                vol: 0.5,
                liq: 0.9,
                hours: "RTH+",
                lever: 0,
                min_cap: 5000,
                reg: 0.95,
                spread: 0.04,
                fee: 0.04,
                borrow: 1.0,
                news: 0.6,
                quant: 0.9,
                discretion: 0.7,
                hold_min: "days",
                hold_max: "months",
                complexity: 0.9
            },
            bonds_etf: { 
                name: "Bond ETFs (TLT, HYG)", 
                class: "fixed_income", 
                vol: 0.15, 
                liq: 0.8, 
                hours: "RTH", 
                lever: 1, 
                min_cap: 500, 
                reg: 0.95, 
                spread: 0.01, 
                fee: 0.005, 
                borrow: 1.0, 
                news: 0.6, 
                quant: 0.6, 
                discretion: 0.5, 
                hold_min: "days", 
                hold_max: "years",
                complexity: 0.2
            },
            reits: { 
                name: "REITs", 
                class: "real_estate", 
                vol: 0.4, 
                liq: 0.7, 
                hours: "RTH", 
                lever: 1, 
                min_cap: 500, 
                reg: 0.9, 
                spread: 0.02, 
                fee: 0.01, 
                borrow: 0.9, 
                news: 0.6, 
                quant: 0.6, 
                discretion: 0.6, 
                hold_min: "days", 
                hold_max: "years",
                complexity: 0.3
            },
            volatility: {
                name: "Volatility Products (VIX, VXX)",
                class: "volatility",
                vol: 1.0,
                liq: 0.7,
                hours: "RTH",
                lever: 1,
                min_cap: 2000,
                reg: 0.9,
                spread: 0.08,
                fee: 0.03,
                borrow: 0.5,
                news: 0.5,
                quant: 0.8,
                discretion: 0.7,
                hold_min: "hours",
                hold_max: "days",
                complexity: 0.9
            }
        };

        // Profile Templates
        const profiles = {
            systematic_swing: {
                name: "Systematic Swing Trader",
                weights: {
                    risk: 6,
                    liquidity: 7,
                    cost: 6,
                    leverage: 4,
                    news: 3,
                    quant: 8,
                    hours24: 2,
                    regulation: 7,
                    timeframe: 6
                }
            },
            options_income: {
                name: "Options Income",
                weights: {
                    risk: 3,
                    liquidity: 8,
                    cost: 5,
                    leverage: 2,
                    news: 4,
                    quant: 7,
                    hours24: 1,
                    regulation: 9,
                    timeframe: 7
                }
            },
            prop_scalper: {
                name: "Prop Firm Scalper",
                weights: {
                    risk: 7,
                    liquidity: 10,
                    cost: 9,
                    leverage: 8,
                    news: 2,
                    quant: 6,
                    hours24: 5,
                    regulation: 6,
                    timeframe: 1
                }
            },
            crypto_momentum: {
                name: "Crypto Momentum",
                weights: {
                    risk: 9,
                    liquidity: 6,
                    cost: 4,
                    leverage: 6,
                    news: 8,
                    quant: 5,
                    hours24: 10,
                    regulation: 3,
                    timeframe: 4
                }
            },
            conservative: {
                name: "Conservative Investor",
                weights: {
                    risk: 2,
                    liquidity: 8,
                    cost: 7,
                    leverage: 1,
                    news: 5,
                    quant: 4,
                    hours24: 1,
                    regulation: 10,
                    timeframe: 8
                }
            },
            custom: {
                name: "Custom Profile",
                weights: {
                    risk: 5,
                    liquidity: 5,
                    cost: 5,
                    leverage: 5,
                    news: 5,
                    quant: 5,
                    hours24: 5,
                    regulation: 5,
                    timeframe: 5
                }
            }
        };

        // State management
        let currentProfile = 'custom';
        let currentConstraints = {};
        let currentResults = [];

        // Load a profile
        function loadProfile(profileKey) {
            currentProfile = profileKey;
            const profile = profiles[profileKey];
            
            // Update all sliders
            Object.keys(profile.weights).forEach(key => {
                document.getElementById(key).value = profile.weights[key];
                document.getElementById(`${key}-value`).textContent = profile.weights[key];
            });
            
            // Update button states
            document.querySelectorAll('.profile-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateResults();
        }

        // Update slider display
        function updateSlider(sliderId) {
            const value = document.getElementById(sliderId).value;
            document.getElementById(`${sliderId}-value`).textContent = value;
            updateResults();
        }

        // Get current weights from sliders
        function getCurrentWeights() {
            return {
                risk: parseFloat(document.getElementById('risk').value) / 10,
                liquidity: parseFloat(document.getElementById('liquidity').value) / 10,
                cost: parseFloat(document.getElementById('cost').value) / 10,
                leverage: parseFloat(document.getElementById('leverage').value) / 10,
                news: parseFloat(document.getElementById('news').value) / 10,
                quant: parseFloat(document.getElementById('quant').value) / 10,
                hours24: parseFloat(document.getElementById('hours24').value) / 10,
                regulation: parseFloat(document.getElementById('regulation').value) / 10,
                timeframe: parseFloat(document.getElementById('timeframe').value) / 10
            };
        }

        // Apply region and account constraints
        function applyConstraints(region, accountType) {
            const constraints = {
                pdt: region === "US" && (accountType === "cash" || accountType === "margin"),
                pdt_limit: region === "US" ? 25000 : 0,
                leverage_cap: region === "EU" ? 5 : (accountType === "prop" ? 20 : 10),
                crypto_allowed: region !== "CN",
                options_allowed: accountType !== "cash",
                futures_allowed: accountType !== "cash"
            };
            return constraints;
        }

        // Update constraints when dropdowns change
        function updateConstraints() {
            const region = document.getElementById('region').value;
            const accountType = document.getElementById('accountType').value;
            currentConstraints = applyConstraints(region, accountType);
            updateResults();
        }

        // TOPSIS Multi-Criteria Ranking Algorithm
        function topsisRank(assets, weights, constraints, bankroll) {
            const rows = Object.entries(assets).map(([k, v]) => ({ key: k, data: v }));
            
            // Filter based on capital requirements and constraints
            let filtered = rows.filter(r => bankroll >= r.data.min_cap);
            
            // Apply constraint filters
            if (constraints.crypto_allowed === false) {
                filtered = filtered.filter(r => r.data.class !== "crypto");
            }
            if (constraints.options_allowed === false) {
                filtered = filtered.filter(r => r.data.class !== "options");
            }
            if (constraints.futures_allowed === false) {
                filtered = filtered.filter(r => r.data.class !== "futures");
            }
            if (constraints.pdt && bankroll < constraints.pdt_limit) {
                // Filter out day trading inappropriate assets
                filtered = filtered.filter(r => r.data.hold_min !== "seconds" && r.data.hold_min !== "minutes");
            }
            
            // Define criteria with types and weights
            const criteria = [
                { key: "vol", type: "cost", weight: weights.risk }, // Lower vol for low risk tolerance
                { key: "liq", type: "benefit", weight: weights.liquidity },
                { key: "spread", type: "cost", weight: weights.cost },
                { key: "fee", type: "cost", weight: weights.cost },
                { key: "reg", type: "benefit", weight: weights.regulation },
                { key: "news", type: "benefit", weight: weights.news },
                { key: "quant", type: "benefit", weight: weights.quant },
                { key: "complexity", type: "cost", weight: 1 - weights.quant } // Higher complexity bad for non-quants
            ];
            
            // Handle 24/7 preference
            filtered.forEach(r => {
                r.hours_score = r.data.hours === "24/7" ? 1 : 
                               r.data.hours === "24/5" ? 0.8 : 
                               r.data.hours === "23/5" ? 0.7 : 0.3;
            });
            criteria.push({ key: "hours_score", type: "benefit", weight: weights.hours24 });
            
            // Handle timeframe preference (0=scalp, 10=position)
            const timeframePref = weights.timeframe;
            filtered.forEach(r => {
                let tfScore = 0.5; // default
                if (timeframePref < 3 && (r.data.hold_min === "seconds" || r.data.hold_min === "minutes")) {
                    tfScore = 1;
                } else if (timeframePref > 7 && (r.data.hold_max === "months" || r.data.hold_max === "years")) {
                    tfScore = 1;
                } else if (timeframePref >= 3 && timeframePref <= 7 && r.data.hold_min === "days") {
                    tfScore = 1;
                }
                r.timeframe_score = tfScore;
            });
            criteria.push({ key: "timeframe_score", type: "benefit", weight: 0.3 });
            
            if (filtered.length === 0) {
                return [];
            }
            
            // Build decision matrix
            const matrix = filtered.map(r => 
                criteria.map(c => {
                    if (c.key === "hours_score" || c.key === "timeframe_score") {
                        return r[c.key];
                    }
                    return r.data[c.key] || 0;
                })
            );
            
            // Normalize weights
            const totalWeight = criteria.reduce((sum, c) => sum + c.weight, 0) || 1;
            const normalizedWeights = criteria.map(c => c.weight / totalWeight);
            
            // Normalize matrix
            const normalizedMatrix = [];
            for (let j = 0; j < criteria.length; j++) {
                const columnValues = matrix.map(row => row[j]);
                const norm = Math.sqrt(columnValues.reduce((sum, val) => sum + val * val, 0)) || 1;
                
                for (let i = 0; i < matrix.length; i++) {
                    if (!normalizedMatrix[i]) normalizedMatrix[i] = [];
                    normalizedMatrix[i][j] = matrix[i][j] / norm;
                }
            }
            
            // Apply weights
            const weightedMatrix = normalizedMatrix.map(row =>
                row.map((val, j) => val * normalizedWeights[j])
            );
            
            // Find ideal and negative-ideal solutions
            const ideal = [];
            const negativeIdeal = [];
            
            for (let j = 0; j < criteria.length; j++) {
                const columnValues = weightedMatrix.map(row => row[j]);
                if (criteria[j].type === "benefit") {
                    ideal[j] = Math.max(...columnValues);
                    negativeIdeal[j] = Math.min(...columnValues);
                } else {
                    ideal[j] = Math.min(...columnValues);
                    negativeIdeal[j] = Math.max(...columnValues);
                }
            }
            
            // Calculate distances and scores
            const scores = weightedMatrix.map((row, i) => {
                const distToIdeal = Math.sqrt(
                    row.reduce((sum, val, j) => sum + Math.pow(val - ideal[j], 2), 0)
                );
                const distToNegativeIdeal = Math.sqrt(
                    row.reduce((sum, val, j) => sum + Math.pow(val - negativeIdeal[j], 2), 0)
                );
                
                const score = distToNegativeIdeal / (distToIdeal + distToNegativeIdeal || 1e-9);
                
                return {
                    key: filtered[i].key,
                    name: filtered[i].data.name,
                    class: filtered[i].data.class,
                    score: Math.round(score * 100),
                    data: filtered[i].data,
                    factors: criteria.map((c, j) => ({
                        name: c.key,
                        value: matrix[i][j],
                        weight: normalizedWeights[j],
                        contribution: Math.abs(weightedMatrix[i][j])
                    }))
                };
            });
            
            return scores.sort((a, b) => b.score - a.score);
        }

        // Factor attribution analysis
        function getTopFactors(result) {
            const factorMap = {
                'vol': 'Volatility Match',
                'liq': 'Liquidity',
                'spread': 'Tight Spreads',
                'fee': 'Low Fees',
                'reg': 'Regulation',
                'news': 'News Trading',
                'quant': 'Quantitative',
                'complexity': 'Simplicity',
                'hours_score': '24/7 Access',
                'timeframe_score': 'Holding Period'
            };
            
            return result.factors
                .sort((a, b) => b.contribution - a.contribution)
                .slice(0, 4)
                .map(f => ({
                    name: factorMap[f.name] || f.name,
                    contribution: Math.round(f.contribution * 100)
                }));
        }

        // Sensitivity analysis
        function performSensitivity() {
            const weights = getCurrentWeights();
            const capital = parseFloat(document.getElementById('capital').value);
            const baseResults = currentResults.slice(0, 3).map(r => r.name);
            
            const sensitivities = [];
            
            // Test each weight dimension
            ['risk', 'liquidity', 'cost', 'leverage'].forEach(dimension => {
                const testWeights = { ...weights };
                testWeights[dimension] = Math.min(1, testWeights[dimension] + 0.2);
                
                const testResults = topsisRank(assetUniverse, testWeights, currentConstraints, capital);
                const topNew = testResults.slice(0, 3).map(r => r.name);
                
                const changes = topNew.filter(name => !baseResults.includes(name));
                if (changes.length > 0) {
                    sensitivities.push({
                        dimension: dimension.charAt(0).toUpperCase() + dimension.slice(1),
                        change: '+20%',
                        result: changes[0]
                    });
                }
            });
            
            return sensitivities;
        }

        // Update results
        function updateResults() {
            const weights = getCurrentWeights();
            const capital = parseFloat(document.getElementById('capital').value);
            const region = document.getElementById('region').value;
            const accountType = document.getElementById('accountType').value;
            
            currentConstraints = applyConstraints(region, accountType);
            currentResults = topsisRank(assetUniverse, weights, currentConstraints, capital);
            
            displayResults();
        }

        // Display results
        function displayResults() {
            if (currentResults.length === 0) {
                document.getElementById('resultsPanel').style.display = 'none';
                return;
            }
            
            document.getElementById('resultsPanel').style.display = 'block';
            
            const resultsHtml = currentResults.slice(0, 5).map((result, index) => {
                const topFactors = getTopFactors(result);
                
                return `
                    <div class="result-item ${index === 0 ? 'top' : ''}">
                        <div class="result-header">
                            <div class="result-name">${result.name}</div>
                            <div class="result-score">${result.score}%</div>
                        </div>
                        <div class="result-class">${result.class.toUpperCase()}</div>
                        <div class="factor-list">
                            ${topFactors.map(factor => `
                                <div class="factor-item">
                                    <span class="factor-name">${factor.name}</span>
                                    <div class="factor-bar">
                                        <div class="factor-fill" style="width: ${factor.contribution}%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('resultsContent').innerHTML = resultsHtml;
            
            // Sensitivity analysis
            const sensitivities = performSensitivity();
            const sensitivityHtml = sensitivities.slice(0, 3).map(s => `
                <div class="sensitivity-item">
                    <span class="sensitivity-change">${s.dimension} ${s.change}</span>
                    <span class="sensitivity-result">→ ${s.result}</span>
                </div>
            `).join('') || '<div class="sensitivity-item">Results are stable</div>';
            
            document.getElementById('sensitivityContent').innerHTML = sensitivityHtml;
        }

        // Calculate and display results
        function calculateAndDisplay() {
            updateResults();
        }

        // Reset all inputs
        function resetAll() {
            // Reset sliders to middle values
            ['risk', 'liquidity', 'cost', 'leverage', 'news', 'quant', 'hours24', 'regulation', 'timeframe'].forEach(id => {
                document.getElementById(id).value = 5;
                document.getElementById(`${id}-value`).textContent = 5;
            });
            
            // Reset other inputs
            document.getElementById('capital').value = 10000;
            document.getElementById('region').value = 'US';
            document.getElementById('accountType').value = 'margin';
            document.getElementById('experience').value = 'intermediate';
            
            // Clear active profile
            document.querySelectorAll('.profile-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            currentProfile = 'custom';
            updateResults();
        }

        // Initialize on load
        window.onload = function() {
            updateConstraints();
            updateResults();
        };
    </script>
</body>
</html>